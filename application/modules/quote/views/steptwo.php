<?php $this->load->view('common/header'); ?>
<section id="page-title" class="dark home_owner_banner">
    <div class="container clearfix">
        <div class="breadcrumb_text text-center">
            <h1 class="text-light">Quote</h1>
        </div>
    </div>
</section>
<section class="content_section quotebg">
    <div class="content-wrap">
        <div class="container clearfix">
            <div class="row nomargin">
                <div class="col-lg-8 col-md-8 col-sm-12 col nopadding quote_from_right quote_left">
                    <div class="quote_from cus_section">
                        <h2>JUST <span> 1 STEP </span>  AWAY FROM COVERING YOUR HOME!</h2>
                        <section class="first_step second_step">
                            <h2>Next let's select your plan & coverage: </h2>
                            <div class="tbl_wrap">
                                <div class="table-responsive">
                                    <table class="gold-table-main table table-striped" align="center">
                                        <thead>
                                        <tr>
                                            <th>Covered Items</th>
                                            <th>System</th>
                                            <th>Combo</th>
                                            <th>Appliance</th>
                                        </tr>
                                        </thead>
                                        <tbody>
                                        <tr></tr>
                                        <tr>
                                            <td>AC System</td>
                                            <td> <img src="<?php echo base_url() ?>assets/front/images/gold-tick.png" alt="Platinum tick" > </td>
                                            <td> <img src="<?php echo base_url() ?>assets/front/images/black-tick.png" alt="Gold tick" ></td>
                                            <td> </td>
                                        </tr>
                                        <tr>
                                            <td>Refrigerator</td>
                                            <td> </td>
                                            <td> <img src="<?php echo base_url() ?>assets/front/images/black-tick.png" alt="Platinum tick" > </td>
                                            <td><img src="<?php echo base_url() ?>assets/front/images/greytick.png" alt="Platinum tick" ></td>
                                        </tr>
                                        <tr>
                                            <td>Heating System</td>
                                            <td> <img src="<?php echo base_url() ?>assets/front/images/gold-tick.png" alt="Platinum tick" > </td>
                                            <td><img src="<?php echo base_url() ?>assets/front/images/black-tick.png" alt="Gold tick" > </td>
                                            <td></td>
                                        </tr>
                                        <tr>
                                            <td>Electrical System</td>
                                            <td> <img src="<?php echo base_url() ?>assets/front/images/gold-tick.png" alt="Platinum tick" > </td>
                                            <td> <img src="<?php echo base_url() ?>assets/front/images/black-tick.png" alt="Gold tick"></td>

                                            <td> </td>
                                        </tr>
                                        <tr>
                                            <td>Clothes Dryer</td>
                                            <td>  </td>
                                            <td> <img src="<?php echo base_url() ?>assets/front/images/black-tick.png" alt="Platinum tick" > </td>
                                            <td> <img src="<?php echo base_url() ?>assets/front/images/greytick.png" alt="Platinum tick" ></td>
                                        </tr>

                                        <tr>
                                            <td>Clothes Washer</td>
                                            <td>  </td>
                                            <td> <img src="<?php echo base_url() ?>assets/front/images/black-tick.png" alt="Platinum tick" > </td>
                                            <td> <img src="<?php echo base_url() ?>assets/front/images/greytick.png" alt="Platinum tick" ></td>
                                        </tr>
                                        <tr>
                                            <td>Plumbing System/Stoppage</td>
                                            <td> <img src="<?php echo base_url() ?>assets/front/images/gold-tick.png" alt="Platinum tick" > </td>
                                            <td> <img src="<?php echo base_url() ?>assets/front/images/black-tick.png" alt="Gold tick" > </td>
                                            <td>  </td>
                                        </tr>
                                        <tr>
                                            <td>Water Heater</td>
                                            <td> <img src="<?php echo base_url() ?>assets/front/images/gold-tick.png" alt="Platinum tick" > </td>
                                            <td> <img src="<?php echo base_url() ?>assets/front/images/black-tick.png" alt="Gold tick" > </td>
                                            <td></td>
                                        </tr>
                                        <tr>
                                            <td>Cooktop</td>
                                            <td>  </td>
                                            <td> <img src="<?php echo base_url() ?>assets/front/images/black-tick.png" alt="Platinum tick" > </td>
                                            <td><img src="<?php echo base_url() ?>assets/front/images/greytick.png" alt="Platinum tick" > </td>
                                        </tr>
                                        <tr>
                                            <td>Ductwork</td>
                                            <td> <img src="<?php echo base_url() ?>assets/front/images/gold-tick.png" alt="Platinum tick" > </td>
                                            <td> <img src="<?php echo base_url() ?>assets/front/images/black-tick.png" alt="Platinum tick" > </td>
                                            <td> </td>
                                        </tr>
                                        <tr>
                                            <td>Built-In Microwave</td>
                                            <td>  </td>
                                            <td> <img src="<?php echo base_url() ?>assets/front/images/black-tick.png" alt="Platinum tick" > </td>
                                            <td> <img src="<?php echo base_url() ?>assets/front/images/greytick.png" alt="Platinum tick" > </td>
                                        </tr>
                                        <tr>
                                            <td>Dishwasher</td>
                                            <td> </td>
                                            <td> <img src="<?php echo base_url() ?>assets/front/images/black-tick.png" alt="Platinum tick" > </td>
                                            <td><img src="<?php echo base_url() ?>assets/front/images/greytick.png" alt="Platinum tick" > </td>
                                        </tr>
                                        <tr>
                                            <td>Garbage Disposal</td>
                                            <td> </td>
                                            <td> <img src="<?php echo base_url() ?>assets/front/images/black-tick.png" alt="Platinum tick" > </td>
                                            <td> <img src="<?php echo base_url() ?>assets/front/images/greytick.png" alt="Platinum tick" > </td>
                                        </tr>
                                        <tr>
                                            <td>Oven/Range/Stove</td>
                                            <td> </td>
                                            <td> <img src="<?php echo base_url() ?>assets/front/images/black-tick.png" alt="Platinum tick" > </td>
                                            <td> <img src="<?php echo base_url() ?>assets/front/images/greytick.png" alt="Gold tick" > </td>
                                        </tr>
                                        <tr>
                                            <td>Garage Door Opener</td>
                                            <td>  </td>
                                            <td> <img src="<?php echo base_url() ?>assets/front/images/black-tick.png" alt="Gold tick" > </td>
                                            <td> <img src="<?php echo base_url() ?>assets/front/images/greytick.png" alt="Platinum tick" > </td>
                                        </tr>
                                        <tr>
                                            <td>Ceiling and Exhaust Fans</td>
                                            <td>  </td>
                                            <td> <img src="<?php echo base_url() ?>assets/front/images/black-tick.png" alt="Gold tick" > </td>
                                            <td> <img src="<?php echo base_url() ?>assets/front/images/greytick.png" alt="Platinum tick" > </td>
                                        </tr>
                                        </tbody>
                                        <tfoot>
                                        <tr>
                                            <th class="pl5">Select Your Plan</th>
                                            <th>
                                                <span>System</span>
                                                <div>
                                                    <input id="radio-5" class="radio-style" name="coverage" value="2" data-text="System" data-val="<?php echo get_setting('plan',2); ?>" type="radio" checked>
                                                    <label for="radio-5" class="radio-style-2-label"></label>
                                                </div>
                                            </th>
                                            <th>
                                                <span>Combo</span>
                                                <div>
                                                    <input id="radio-6" class="radio-style" name="coverage" value="1" data-text="Combo" data-val="<?php echo get_setting('plan',1); ?>" type="radio">
                                                    <label for="radio-6" class="radio-style-2-label"></label>
                                                </div>
                                            </th>
                                            <th>
                                                <span>Appliance</span>
                                                <div>
                                                    <input id="radio-7" class="radio-style" name="coverage" value="3" data-text="Appliance" data-val="<?php echo get_setting('plan',3); ?>" type="radio">
                                                    <label for="radio-7" class="radio-style-2-label"></label>
                                                </div>
                                            </th>
                                        </tr>
                                        </tfoot>
                                    </table>
                                </div>
                                <form id="policy-form" method="post">
                                    <div class="row">
                                        <div class="col-sm-12">
                                            <label for="fname">Accepted Cards</label>
                                            <br>
                                            <div class="icon-container">
                                                <i class="fa fa-cc-visa"  id="visa"></i>
                                                <i class="fa fa-cc-amex"  id="amex"></i>
                                                <i class="fa fa-cc-mastercard"  id="master-card"></i>
                                            </div>
                                        </div>
                                    </div>
                                    <br>
                                    <div class="row">
                                        <div class="col-lg-6 col-md-6 col-sm-6">
                                            <div class="form-group">
                                                <input type="number" id="ccnum" name="cardnumber" placeholder="Card-Number" class="form-control form_focus required" required>
                                            </div>
                                        </div>
                                        <div class="col-lg-6 col-md-6 col-sm-6">
                                            <div class="form-group">
                                                <input type="number" id="cvv" name="cvv" placeholder="CVV"  class="form-control form_focus required" required>
                                            </div>
                                        </div>
                                        <div class="col-lg-6 col-md-6 col-sm-6">
                                            <div class="form-group">
                                                <select class="form-control" name="card_month" required="required">
                                                    <option value="">Expiry Month</option>
                                                    <option value="1">1</option>
                                                    <option value="2">2</option>
                                                    <option value="3">3</option>
                                                    <option value="4">4</option>
                                                    <option value="5">5</option>
                                                    <option value="6">6</option>
                                                    <option value="7">7</option>
                                                    <option value="8">8</option>
                                                    <option value="9">9</option>
                                                    <option value="10">10</option>
                                                    <option value="11">11</option>
                                                    <option value="12">12</option>
                                                </select>
                                            </div>
                                        </div>
                                        <div class="col-lg-6 col-md-6 col-sm-6">
                                            <div class="form-group">
                                                <select class="form-control card-year" name="card_year" required="required">
                                                    <option value="">Year</option>
                                                    <?php $cur_year = date("Y");
                                                    for ($x = $cur_year; $x <= $cur_year+10; $x++){ ?>
                                                        <option value="<?php echo $x; ?>"><?php echo $x; ?></option>
                                                    <?php } ?>
                                                </select>
                                            </div>
                                        </div>
                                    </div>
                                    <!-- ..........checkbox-section..............start........... -->

                                    <div class="checkbox-section">
                                        <div class="row coverage-sec-main">
                                            <h2 class="cbs-head">
                                                Select Optional Coverage
                                            </h2>
                                            <?php foreach (get_setting('opt_coverage','',1) as $coverage){ ?>
                                                <div class="col-md-4 col-sm-6">
                                                    <label><input type="checkbox" class="opt-coverage" value="<?php echo $coverage['meta_key']; ?>" data-val="<?php echo $coverage['meta_value']; ?>" data-id="<?php echo $coverage['meta_content']; ?>" name="opt_coverage"> <?php echo $coverage['meta_content']; ?></label>
                                                </div>
                                            <?php } ?>
                                            <div class="col-lg-12 col-md-12">
                                                <div class="quote_btn">
                                                    <button class="submit form-submit" type="submit"><span>Finish</span></button>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </form>
                            </div>
                        </section>
                    </div>
                </div>
                <div class="col-lg-4 col-md-4 col-sm-12 col nopadding step-two-sec">
                    <div class="quotereviews quotereviews2">
                        <div class="skew_bg"></div>
                        <h3>1 MONTH FREE!<sup>*</sup></h3>
                        <div class="st-sidebar-content">
                            <h1 class="sc-heading">
                                my Plan:
                            </h1>
                            <h2>CONTRACT OWNER</h2>
                            <?php if (!empty($_SESSION['plan'])){ ?>
                                <p><?php echo $_SESSION['plan']['FirstName'].' '.$_SESSION['plan']['LastName']; ?></p>
                            <?php } ?>
                            <h2>Covered Property</h2>
                            <?php if (!empty($_SESSION['plan'])){ ?>
                                <p><?php
                                    $property = get_plan_name('property_type',$_SESSION['plan']['propertyType']);
                                    $size = get_setting('property_size', $_SESSION['plan']['propertySize']);
                                    echo $property['meta_content']; ?>
                                </p>
                                <span class="hidden" id="property_type"><?php echo $property['meta_value']; ?></span>
                                <span class="hidden" id="property_size"><?php echo $size; ?></span>
                            <?php } ?>
                            <span class="hidden" id="plan_type">420</span>
                            <h2>My Coverage</h2>
                            <table class="table">
                                <tr>
                                    <td id="coverage-name">System</td>
                                    <td id="coverage-value">$420</td>
                                </tr>
                            </table>
                            <h2>Extras</h2>

                            <table class="table extra-coverage"></table>
                            <h2>Term</h2>
                            <p id="plan-length">Yearly</p>
                            <h2>Service Fee</h2>
                            <p>$<span>75.00</span> per visit</p>
                            <h2>Coupon Code</h2>
                            <div class="form-group">
                                <form method="post">
                                    <input type="text" class="form-control">
                                    <a class="btn btn-default" href="">APPLY</a>
                                </form>
                            </div>
                            <h2>Payment Schedule</h2>
                            <div class="form-group">
                                <form method="post">
                                    <div>
                                        <input id="radio-8" class="radio-style" name="payment_type" value="2" type="radio">
                                        <label for="radio-8" class="radio-style-2-label">Monthly Payment</label>
                                    </div>
                                    <div>
                                        <input id="radio-9" class="radio-style" name="payment_type" value="1" type="radio" checked>
                                        <label for="radio-9" class="radio-style-2-label">Single Payment</label>
                                    </div>
                                </form>
                            </div>
                            <h1 class="sc-heading total-price-heading">
                                Total:
                                <p id="total-sum">$100.00</p>
                            </h1>
                        </div>
                        <div class="logos">
                            <img alt="" src="<?php echo base_url() ?>assets/front/images/30_days_guarantee.png">
                            <img alt="" src="<?php echo base_url() ?>assets/front/images/google_rating.png">
                        </div>
                    </div>

                </div>
            </div>
        </div>
    </div>
</section>
<?php $this->load->view('common/footer'); ?>
<script>
    $(document).ready(function () {

        var coverage = $('input[name=coverage]:checked').data('text');
        var coverage_price = $('input[name=coverage]:checked').data('val');
        $('#coverage-name').html(coverage);
        $('#coverage-value').html('$'+coverage_price);
        $('#plan_type').html(coverage_price);

        var init_total = calculate_plan();
        $('#total-sum').html('$'+init_total);

        $('input[type=radio][name=coverage]').on('change', function() {
            var coverage = $(this).data('text');
            var coverage_price = $(this).data('val');
            $('#coverage-name').html(coverage);
            $('#coverage-value').html('$'+coverage_price);
            $('#plan_type').html(coverage_price);
            var plan_amount = calculate_plan();
            $('#total-sum').html('$'+plan_amount);
        });

        $('input[type=radio][name=payment_type]').on('change', function() {
            var type = $(this).val();
            if (type==1){
                $('#plan-length').html('Yearly');
            } else {
                $('#plan-length').html('Monthly');
            }
            var plan_amount = calculate_plan();
            $('#total-sum').html('$'+plan_amount);
        });

        $('input[name="opt_coverage"]').on('change', function () {
            extra_options();
            var plan_amount = calculate_plan();
            $('#total-sum').html('$'+plan_amount);
        });


        $('#policy-form').submit(function (e) {
            e.preventDefault();
            $('.form-submit').attr('disabled', true).css('opacity', '0.5').css('cursor', 'wait');
            var coverage = [];
            $('input[name="opt_coverage"]:checked').each(function() {
                coverage.push($(this).val());
            });
            var plan = $('input[name=coverage]:checked').val();
            var schedule = $('input[name=payment_type]:checked').val();
            var value = new FormData( $("#policy-form")[0] );
            value.append("coverage", coverage);
            value.append("plan", plan);
            value.append("schedule", schedule);

            $.ajax({
                url:base_url+'quote/save_plan',
                type:'post',
                data:value,
                dataType:'json',
                processData: false,
                contentType: false,
                success:function(status){
                    if(status.msg=='success'){
                        toastr.success(status.response, 'Success');
                        setTimeout(function () {
                            $('.form-submit').removeAttr('disabled').css('opacity', '1').css('cursor', 'initial');
                            $(location).attr('href', base_url);
                        }, 2000);
                    }
                    else if(status.msg == 'error'){
                        $('.form-submit').removeAttr('disabled').css('opacity', '1').css('cursor', 'initial');
                        toastr.error(status.response, 'Error');
                    }
                }
            });
        });




        function calculate_plan() {
            var property = $('#property_type').html();
            var size = $('#property_size').html();
            var plan_total = $('#plan_type').html();
            var optional_coverage = extra_coverage();
            var total = parseFloat(property) + parseFloat(size) + parseFloat(optional_coverage) + parseFloat(plan_total);
            var payment_type = $('input[name=payment_type]:checked').val();
            var after_split = total;
            if (payment_type==2){
                after_split = total/12;
                after_split = Math.round(after_split);
                return after_split;
            }else {
                return (after_split).toFixed(2);
            }

        }

        function extra_coverage() {
            var total=0;
            $('input[name="opt_coverage"]:checked').each(function() {
                var month_price = parseFloat($(this).attr('data-val'));
                total = total + month_price;
            });
            return total;
        }


        function extra_options() {
            $('.extra-coverage').html('');
            $('input[name="opt_coverage"]:checked').each(function() {
                var name = $(this).attr('data-id');
                var value = $(this).attr('data-val');

                $('.extra-coverage').append("<tr>\n" +
                    "<td>"+name+"</td>\n" +
                    "<td>$"+parseFloat(value)+"</td>\n" +
                    "</tr>");
            });
        }

    });
</script>
